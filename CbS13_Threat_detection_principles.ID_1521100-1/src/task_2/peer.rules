# Komanda dlya zapuska: [~/suricata-lab] suricata -r pcap/malicious_traffic.pcap -S rules/peer.rules -l logs/ -v


# Правило 1: Детектирование C2 handshake на порт 4444
alert tcp any any -> any 4444 (msg:"C2 Communication Detected - Handshake to port 4444"; \
    content:"C2"; \
    content:"handshake"; distance:0; \
    classtype:trojan-activity; \
    sid:1000001; \
    rev:2;)

# Правило 2: Детектирование HTTP-запроса на загрузку малвари
alert tcp any any -> any any (msg:"Malware Download Attempt - GET /malware"; \
    content:"GET"; \
    content:"/malware"; distance:0; within:100; \
    classtype:trojan-activity; \
    sid:1000002; \
    rev:3;)

# Правило 3: Детектирование DNS-запроса к подозрительному домену
alert dns any any -> any 53 (msg:"Suspicious DNS Query - malicious-domain.com"; \
    dns.query; content:"malicious-domain.com"; nocase; \
    classtype:trojan-activity; \
    sid:1000003; \
    rev:1;)

# Правило 4: Детектирование множественных подключений к backdoor-порту
alert tcp any any -> 192.168.1.200 4444 (msg:"Backdoor Activity - Connection to 192.168.1.200:4444"; \
    flow:to_server; \
    flags:S; \
    threshold:type threshold, track by_src, count 1, seconds 60; \
    classtype:trojan-activity; \
    sid:1000004; \
    rev:1;)
