#!/usr/bin/env python3
# -*- coding: utf-8 -*-

def integer_nth_root(a, n):
    """Вычисляет целый n-й корень из a методом Ньютона"""
    if a == 0:
        return 0
    
    x = a
    while True:
        x_new = ((n - 1) * x + a // (x ** (n - 1))) // n
        if x_new >= x:
            return x
        x = x_new

# Зашифрованный текст
c = 0xed924527ff3a43600e318248daa62a18307096f78f5ea899598eb5ce7de2adbd6565ce5cfe896dcee24521f615cedb8236ed642a1966592cac7cae40412a717594e75b58d610b9ca2ea8642c336b804357ca1f405f9b713a9f492f1a85b64e9601385fb872a1c9e487af698727359e91221c3e3acacd476ab374469daf586c11bf1a5eb09a957670be8b353c901868d86bf2fe9074361a2a54c73df56ca38d

# Модуль
n = 826280450476795403105390383916395625701073920777162153138597185953056944510888027904354828464602421249363674719063026424044747076553321187265165775178889032794638105579799203345357910166892700405175658568627675449699540840288382597105404255643311670752496397923267416409538484199324051251779098290351314013642933189000153869540797043267546151497242578717464980825955180662199508957183411268811625401646070827084944007483568527240194185553478349118552388947992831458170444492412952312967110446929914832061366940165718329077289379496793520793044453012845571593091239615903167358140251268988719634075550032402744471298472559374963794796831888972573597223883502207025864412727194467531305956804869282127211781893423868568924921460804452906287133831167209340798856323714333552031073990953099946860260440120550744737264831895097569281340675979651355169393606387485601024283179141075124116079680183641040638005340147490312370291020282845417263785200481799143148652902589069064306494803532124234850362800892646823909347208346956741220877224626765444423081432186871792825772139369254830825377015531518313838382717867736340509229694011716101360463757629023320658921011843627332643744464724204771008866440681008984222122706436344770910544932757

# Экспонента
e = 5

# Атака на малую экспоненту: находим e-й корень из c
print(f"[*] Начинаем восстановление исходного текста...")
print(f"[*] Вычисляем {e}-й корень из c...")

m = integer_nth_root(c, e)

print(f"[+] Найдено значение m")

# Конвертируем число в байты
m_bytes = m.to_bytes((m.bit_length() + 7) // 8, byteorder='big')

# Декодируем в UTF-8
try:
    plaintext = m_bytes.decode('utf-8')
    print(f"[+] Исходный текст (UTF-8):")
    print(plaintext)
    
    # Записываем в файл
    with open('RSA_cracked.txt', 'w', encoding='utf-8') as f:
        f.write(plaintext)
    print(f"[+] Текст сохранён в RSA_cracked.txt")
    
except Exception as e:
    print(f"[-] Ошибка при декодировании: {e}")
    print(f"[*] Байты: {m_bytes.hex()}")
